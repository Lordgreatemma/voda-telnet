/* Licensing info */
const a="https://vfgh-test.telenity.com";let d="";const t=["5201004","5202034","5202035","5202036","5202037"];let i=60,r=120,c,l,u;function m(e,t,n,i,r){let o=document.getElementById("regenerate");o.style.display="block",o.style.pointerEvents="none",o.style.cursor="default",o.style.background="lightgray",o.onclick=function(){h(e,t,n,i,r)}}function o(){let e=document.getElementById("regenerate");e.style.pointerEvents=null,e.style.cursor=null,e.style.background=null}const p=async n=>{setInterval(function(){var e,t;i<=0?(o(),document.getElementById("regenerate").innerText="Resend OTP"):(e=i%60,t=Math.floor(i/60),document.getElementById("regenerate").innerText=e<10?"Resend OTP "+t+":0"+e:"Resend OTP "+t+":"+e,--i),r<=0&&window.location.replace(d+"?"+encodeURIComponent("action="+n+"&result=false&error=8001001&errorCode=70408&msisdn=&subscriptionId=&transactionId="+c+"&status=&serviceid="+l+"&advertisingid="+u)),--r},1e3)},s=async()=>{i=60,r=120,document.getElementById("regenerateTimer").hidden=!1},g=async e=>t.includes(e),v=async(t,n,i)=>{try{let e=document.getElementById("msisdnInput").value;if(9===e.length?e="233"+e:10===e.length&&e.startsWith("0")&&(e="233"+e.substring(1)),12!==e.length)alert("Please enter a valid number");else{window.location.hostname;var r={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+n},body:JSON.stringify({sender:i,target:e})};const o=await fetch(a+"/vfgh/gw/otp/v1/sms",r);if(200===o.status){const s=await o.json();document.getElementById("msisdnInput").value="",document.getElementById("msisdnInput").placeholder="Verification Code",document.getElementById("trxId").value=s.trxid,document.getElementById("submit").onclick=function(){b(n,e,t,s.trxid)},m(n,e,s.trxid,t,i),p(t),"signup"===t?(document.getElementById("submit").innerText="Subscribe",await C(n)):document.getElementById("submit").innerText="Signin"}else window.location.replace(d+"?"+encodeURIComponent("action="+t+"&result=false&error=8001001&errorCode=70"+o.status+"&msisdn=&subscriptionId=&transactionid="+c+"&status=&serviceid="+l+"&advertisingid="+u))}}catch(e){alert(e.message)}},h=async(e,t,n,i,r)=>{var o={method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+e},body:JSON.stringify({sender:r,target:t})},o=await fetch(a+"/vfgh/gw/otp/v1/sms/"+n,o);200===o.status?(m(e,t,n,i,r),await s()):window.location.replace(d+"?"+encodeURIComponent("action="+i+"&result=false&error=8001001&errorCode=70"+o.status+"&msisdn=&subscriptionId=&transactionId="+c+"&status=&serviceid="+l+"&advertisingid="+u))},e=async(n,i,r)=>{try{let e=new URL(a+"/registerhelper/decrypt"),t={msisdn:n};e.search=new URLSearchParams(t).toString();await fetch(e,{method:"GET"}).then(e=>e.text()).then(e=>{document.getElementById("msisdnInput").value=e,y(i,e,r)})}catch(e){alert(e.message)}},f=async(e,t,n)=>{if(e)C(n),document.getElementById("msisdnInput").value=e,document.getElementById("submit").onclick=function(){w(t,n)};else{e={method:"GET",headers:{Accept:"application/json",Authorization:"Bearer "+n}};const i=await fetch(a+"/vfgh/gw/subscription/v2/servicename",e),r=(await i.json()).shortcode;document.getElementById("submit").innerHTML="Send OTP",document.getElementById("msisdnInput").removeAttribute("readonly"),document.getElementById("submit").onclick=function(){v(t,n,r)}}document.getElementById("register-container").hidden=!1},I=async(e,t)=>{e={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+e}};const n=await fetch(a+"/vfgh/gw/subscription/v2/issubscribed/"+t,e);e=await n.json();return e},y=async(t,e,n)=>{var i=await I(t,e);if(i)"signin"===n?window.location.replace(d+"?"+encodeURIComponent("action="+n+"&result=true&msisdn="+e+"&subscriptionId=&error=&errorCode=&transactionId="+c+"&status=&serviceid="+l+"&advertisingid="+u)):window.location.replace(d+"?"+encodeURIComponent("action="+n+"&result=false&msisdn="+e+"&subscriptionId=&error=8001022&errorCode=5201004&transactionId="+c+"&status=&serviceid="+l+"&advertisingid="+u));else if("signin"===n)window.location.replace(d+"?"+encodeURIComponent("action="+n+"&result="+i+"&msisdn=&subscriptionId=&error=&errorCode=&transactionId="+c+"&status=&serviceid="+l+"&advertisingid="+u));else{await C(t);let e=await document.getElementById("register-container");e.hidden=!1}},w=async(n,i)=>{try{var r=document.getElementById("msisdnInput").value;let e="";document.querySelector('input[name="offerForm"]:checked')&&(e=document.querySelector('input[name="offerForm"]:checked').value);var o={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+i},body:JSON.stringify({TransactionId:c,Channel:"web",msisdn:r,offer:e})};let t=await fetch(a+"/vfgh/gw/subscription/v2/subscribe",o);var s=await t.json();200===t.status?window.location.replace(d+"?"+encodeURIComponent("action="+n+"&result=true&msisdn="+r+"&subscriptionId="+s.subscriptionId+"&error=&errorCode=&transactionId="+c+"&status=&serviceid="+l+"&advertisingid="+u)):g(s.errorCode)?window.location.replace(d+"?"+encodeURIComponent("action="+n+"&result=false&msisdn="+r+"&error="+s.code+"&errorCode="+s.errorCode+"&subscriptionId=&transactionId="+c+"&status=&serviceid="+l+"&advertisingid="+u)):window.location.replace(d+"?"+encodeURIComponent("action="+n+"&result=false&msisdn=&error="+s.code+"&errorCode="+s.errorCode+"&msisdn=&subscriptionId=&transactionId="+c+"&status=&serviceid="+l+"&advertisingid="+u))}catch(e){alert(e.message)}},b=async(n,i,r,e)=>{var t={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+n}},t=await fetch(a+"/vfgh/gw/otp/v1/verify/"+document.getElementById("msisdnInput").value+"/"+e,t);if(200===t.status)if(await I(n,i))"signin"===r?window.location.replace(d+"?"+encodeURIComponent("action="+r+"&result=true&msisdn="+i+"&subscriptionId=&error=&errorCode=&transactionId="+c+"&status=&serviceid="+l+"&advertisingid="+u)):window.location.replace(d+"?"+encodeURIComponent("action="+r+"&result=false&msisdn="+i+"&subscriptionId=&error=8001022&errorCode=5201004&transactionId="+c+"&status=&serviceid="+l+"&advertisingid="+u));else{let e="";document.querySelector('input[name="offerForm"]:checked')&&(e=document.querySelector('input[name="offerForm"]:checked').value);n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+n},body:JSON.stringify({TransactionId:c,Channel:"web",msisdn:i,offer:e})};let t=await fetch(a+"/vfgh/gw/subscription/v2/subscribe",n);n=await t.json();200===t.status?window.location.replace(d+"?"+encodeURIComponent("action="+r+"&result=true&msisdn="+i+"&subscriptionId="+n.subscriptionId+"&error=&errorCode=&transactionId="+c+"&status=&serviceid="+l+"&advertisingid="+u)):g(n.errorCode)?window.location.replace(d+"?"+encodeURIComponent("action="+r+"&result=false&msisdn="+i+"&error="+n.code+"&errorCode="+n.errorCode+"&subscriptionId=&transactionId="+c+"&status=&serviceid="+l+"&advertisingid="+u)):window.location.replace(d+"?"+encodeURIComponent("action="+r+"&result=false&error="+n.code+"&errorCode="+n.errorCode+"&msisdn=&subscriptionId=&transactionId="+c+"&status=&serviceid="+l+"&advertisingid="+u))}else window.location.replace(d+"?"+encodeURIComponent("action="+r+"&result=false&error=8001001&errorCode=70"+t.status+"&msisdn=&subscriptionId=&transactionId="+c+"&status=&serviceid="+l+"&advertisingid="+u))},C=async e=>{e={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+e}};const t=document.getElementById("offerList"),n=await fetch(a+"/vfgh/gw/partner/v1/offers",e);var i=await n.json();let r='<div class="col-100">';for(let e=0;e<i.offers.length;e++)r+='<input class="inputs"  type="radio" name="offerForm" value="'+i.offers[e].name+'" checked> '+i.offers[e].name+"</input>\n";r+="</div>",t.innerHTML=r,t.hidden=!1},n=()=>{let e=document.getElementById("script").src;var t=document.domain.replace("www.","");return e.includes(t)},E=async()=>{try{const e=await fetch("http://vfgh-test.telenity.com/registerhelper4/getanddecrypt",{method:"GET"});return await e.json()}catch(e){return null}},B=async(e,t)=>{var n=await E();null===n||""===n||void 0===n?await f(null,e,t):await f(n,e,t)};!function(){{const o=new URL(decodeURIComponent(location.href)).searchParams;d=o.get("callbackUrl"),c=o.get("transactionId");var t=o.get("token");void 0===t&&0;var n=o.get("action");void 0===n&&0,null===d&&(d=document.referrer.split("?")[0]),null===c&&(c=("000"+(466561249*Math.random()|0).toString(36)).slice(-6)+("000"+(466561249*Math.random()|0).toString(36)).slice(-6)),l=o.get("serviceid"),null===l&&(l=""),u=o.get("advertisingid"),null===u&&(u="");let e=Object.create({create(){const e=document.createElement("div");return e.classList.add("register-box"),e.innerHTML='<div id="register-container" class="container" hidden>                                    <form id="register">                                      <div class="inputs">                                       <div class="row" id="offerList" hidden></div>                                        <div class="row">                                       <div id="msisdnInputExp" class="col-100">                                           <label>Enter your Vodafone Mobile number</label>                                         </div>                                       </div>                                       <div class="row">                                         <div class="col-100">                                         <input id="trxId" type="hidden" value="" />                                           <input type="text" id="msisdnInput" name="msisdnInput" placeholder="Phone Number (eg. 233123456789)" autofocus readonly>                                         </div>                                       </div>                                       <div class="row">                                         <div class="col-100">                                         <a id="submit" type="submit" href="#">Subscribe</a>                                         <a id="regenerate" type="submit"  href="#" style="display:none">Resend OTP</a>                                         </div>                                       </div>                                     </div>                                   </form>                                 </div>',e}});var i=e.create(),r="register-"+Math.floor(65536*(1+Math.random())).toString(16).substring(1);document.write(`<div id="${r}"></div>`),document.getElementById(r).appendChild(i),B(n,t)}}();